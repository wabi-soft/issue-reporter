{# @var plugin \wabisoft\craftissuereporter\IssueReporter #}
{# @var settings \wabisoft\craftissuereporter\models\Settings #}

{% import '_includes/forms.twig' as forms %}

<h2>IssueRelay Credentials</h2>
<p class="light">Copy these from your <a href="https://issuerelay.com" target="_blank">IssueRelay</a> project settings.</p>

{{ forms.textField({
    label: 'Host URL',
    name: 'hostUrl',
    value: settings.hostUrl,
    placeholder: 'https://issuerelay.com',
    required: true,
    errors: settings.getErrors('hostUrl'),
}) }}

{{ forms.textField({
    label: 'Project UUID',
    name: 'projectUuid',
    value: settings.projectUuid,
    required: true,
    errors: settings.getErrors('projectUuid'),
}) }}

{{ forms.textField({
    label: 'API Key',
    instructions: 'For your reference only â€” not used by the plugin.',
    name: 'apiKey',
    value: settings.apiKey,
    errors: settings.getErrors('apiKey'),
}) }}

{{ forms.passwordField({
    label: 'API Secret',
    instructions: 'Used to sign widget tokens. For production, use `$ENV_VAR` syntax.',
    name: 'apiSecret',
    value: settings.apiSecret,
    required: true,
    errors: settings.getErrors('apiSecret'),
}) }}

<hr>

<h2>Widget Settings</h2>

{{ forms.lightswitchField({
    label: 'Auto-inject Widget',
    instructions: 'Automatically add the widget to all front-end pages for logged-in CP users. When off, use `{{ issueRelayWidget() }}` in your templates.',
    name: 'autoInject',
    on: settings.autoInject,
}) }}

{{ forms.textField({
    label: 'Token TTL (seconds)',
    instructions: 'How long widget tokens remain valid. Default: 3600 (1 hour).',
    name: 'tokenTtl',
    value: settings.tokenTtl,
    type: 'number',
    size: 10,
    errors: settings.getErrors('tokenTtl'),
}) }}

{% set userGroupOptions = craft.app.userGroups.getAllGroups() | map(g => { label: g.name, value: g.uid }) %}
{% if userGroupOptions | length %}
    {{ forms.checkboxSelectField({
        label: 'Allowed User Groups',
        instructions: 'Leave empty to allow all logged-in CP users.',
        name: 'allowedUserGroups',
        values: settings.allowedUserGroups,
        options: userGroupOptions,
    }) }}
{% endif %}

<hr>
<h2>Log Settings</h2>

{{ forms.textField({
    label: 'Log Files',
    instructions: 'Log filenames from `storage/logs/` to include with issue submissions. Supports wildcards (`*.log`) and comma-separated names (`web.log, queue.log`). Leave empty to disable.',
    id: 'logFiles',
    name: 'logFiles',
    value: settings.logFiles,
    errors: settings.getErrors('logFiles'),
}) }}
